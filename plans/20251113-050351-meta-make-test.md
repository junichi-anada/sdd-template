# Plan: meta: make test にシェルテストを統合

## 方針
- アーキテクチャ/設計方針:
	- 既存の `scripts/test.sh` にシェルテスト実行ロジックを内包し、単一エントリポイントを維持する。
	- PHPUnit 実行とシェルテスト実行を段階分離し、双方の結果を集約サマリで出力。
	- 発見(Discover)→フィルタ(実行権限)→実行→集約の直列パイプライン。
- データモデル/スキーマ:
	- なし（ファイルシステム上の `tests/**/*.sh`）。
- インターフェース/API:
	- `make test` → `scripts/test.sh` が PHP と Shell を順次評価。
	- 退出コード: いずれかが失敗したら非ゼロ。複数失敗時も非ゼロ（最終的に 1 を返す）。

## タスク分解（SDD順序）
1) 仕様確定（承認）
2) テスト設計（受け入れ基準に対応）
3) 実装（テストをグリーンに）
4) リファクタリングと観測性の追加
5) セキュリティ/パフォーマンス確認

## 具体タスク
| ID | 種別(SPEC/TEST/CODE/OPS) | 内容 | 完了条件 |
|----|--------------------------|------|----------|
| T-1 | TEST | 受け入れ基準テストをシェルで用意: (1) PHP無しで `tests/meta_spec_generation.sh` が自動実行され exit 0、(2) ダミー失敗テストで exit >0、(3) 実行権限無しは警告スキップ | 手元実行で基準を満たす |
| T-2 | CODE | `scripts/test.sh` にシェルテスト実行ステップを追加（探索・ログ・集約）。PHPUnit の有無/失敗に関わらずシェルを実行 | ローカルで T-1 がグリーン |
| T-3 | CODE | 実行権限チェックとスキップ警告の実装 | 非実行権限ファイルで警告が出る |
| T-4 | CODE | ログ整形（=== PHPUnit === / === Shell === の区切りと失敗一覧） | 出力が読みやすい |
| T-5 | TEST | 失敗時の終了コードと失敗テスト名の列挙を検証 | 条件通りに出力/終了コード |
| T-6 | OPS | ドキュメント更新 (`README.md`, `docs/sdd-flow.md`) に make test のシェル統合を明記 | PR レビューで確認 |

## スケジュール
- 着手: 2025-11-13
- 完了予定: 2025-11-13

## リスク/ブロッカー
- リスク: テスト数増に伴う時間増加 → 現状は直列実行で許容、必要なら別フェーズで並列化。
- ブロッカー: なし。

## 承認
- Plan 作成者: GitHub Copilot Agent
- レビュー: Owner
- 承認日時: 2025-11-13T00:00:00+09:00
- ステータス: APPROVED
